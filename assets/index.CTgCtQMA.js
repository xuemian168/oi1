var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,r=(e,t,n)=>new Promise((i,s)=>{var a=e=>{try{r(n.next(e))}catch(t){s(t)}},o=e=>{try{r(n.throw(e))}catch(t){s(t)}},r=e=>e.done?i(e.value):Promise.resolve(e.value).then(a,o);r((n=n.apply(e,t)).next())});!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const c={app:{title:"oi1 视觉加密工具",subtitle:"基于 O0Il 相似字符的视觉混淆加密"},ui:{encrypt:"加密",decrypt:"解密",copy:"复制",paste:"粘贴",clear:"清空",help:"算法说明",demo:"演示",expand:"展开",collapse:"收起",export:"导出",import:"导入",settings:"设置"},encoder:{title:"加密器",subtitle:"将文本转换为 O0Il 字符",input:{label:"原文输入",placeholder:"请输入要加密的文本..."},output:{label:"密文输出",placeholder:"加密结果将在这里显示..."}},decoder:{title:"解密器",subtitle:"将 O0Il 字符还原为文本",input:{label:"密文输入",placeholder:"请输入由 O0Il 组成的密文..."},output:{label:"原文输出",placeholder:"解密结果将在这里显示..."}},validation:{valid:"密文格式正确",invalid:"密文格式错误",empty:"输入不能为空",invalidChar:"包含无效字符",invalidLength:"长度不正确",crcVerified:"CRC32校验通过，数据完整",legacyFormat:"旧版格式（无校验）",noCrc:"无CRC校验"},demo:{title:"算法原理演示",toggle:"切换演示",encoding:"编码过程",decoding:"解码过程",step:"步骤",input:"输入",output:"输出",technical:"技术详情",steps:{encoding:{step1:{title:"文本转UTF-8字节",description:"将输入文本转换为UTF-8编码的字节数组"},step2:{title:"计算CRC32校验码",description:"计算字节数组的CRC32校验和，用于数据完整性验证"},step3:{title:"字节转二进制",description:"将每个字节转换为8位二进制数"},step4:{title:"二进制分组",description:"将二进制串按每2位分组，准备映射到字符"},step5:{title:"映射到O0Il字符",description:"将每个2位二进制组映射到对应的视觉混淆字符"},step6:{title:"附加CRC32校验码",description:"将CRC32校验码以O0Il字符形式无缝附加到主密文末尾"}},decoding:{step1:{title:"格式检测",description:"检测密文格式版本，确定是否包含CRC32校验码"},step2:{title:"分离CRC32校验码",description:"从v2格式密文末尾分离16字符CRC32校验码"},step3:{title:"字符反映射",description:"将主密文的O0Il字符反映射为二进制"},step4:{title:"重组为字节",description:"将二进制串按8位分组转换为字节"},step5:{title:"UTF-8解码",description:"将字节数组解码为UTF-8文本"},step6:{title:"CRC32校验验证",description:"计算解码文本的CRC32值并与密文中的校验码比较"},legacyNote:{title:"格式说明",description:"v1格式密文无CRC32校验码，无法验证数据完整性"}}}},help:{title:"oi1 算法原理",similarity:{title:"视觉相似性对比",pairs:[{char1:"O",char2:"0",desc:"大写O ↔ 数字零"},{char1:"I",char2:"l",desc:"大写I ↔ 小写L"}]},mapping:{title:"字符映射表",subtitle:"算法将文本转为二进制，每2位二进制映射为一个字符：",table:[{binary:"00",char:"O",desc:"大写字母 O"},{binary:"01",char:"0",desc:"数字零"},{binary:"10",char:"I",desc:"大写字母 I"},{binary:"11",char:"l",desc:"小写字母 L"}]},process:{title:"加密流程",steps:[{number:"1",title:"文本输入",desc:"输入任意UTF-8文本"},{number:"2",title:"UTF-8编码",desc:"转换为字节数组"},{number:"3",title:"二进制转换",desc:"每字节转为8位二进制"},{number:"4",title:"字符映射",desc:"每2位二进制映射为O0Il字符"},{number:"✓",title:"密文输出",desc:"仅含O0Il的视觉混淆文本"}]},example:{title:"加密示例",subtitle:'示例：加密 "Hi"',steps:[{label:"原文：",value:'"Hi"'},{label:"UTF-8：",value:"[72, 105]"},{label:"二进制：",value:"01001000 01101001"},{label:"分组：",value:"01|00|10|00 01|10|10|01"},{label:"映射：",value:"0|O|I|O 0|I|I|0"},{label:"密文：",value:"0OIO0II0"}]},visual:{title:"视觉效果对比",normal:"普通字体：0OIO0II0",mono:"等宽字体：0OIO0II0"},security:{title:"安全特性",features:[{icon:"🔒",title:"本地处理",desc:"加密过程完全在浏览器本地执行，不上传任何数据。支持离线使用，保护隐私安全。"},{icon:"👁️",title:"视觉混淆",desc:"通过视觉相似字符隐藏真实内容，适用于需要视觉隐蔽的场景。"},{icon:"🔄",title:"完全可逆",desc:"标准模式下保证100%可逆，无信息损失。"}],warning:"注意： 本工具主要用于视觉混淆，不提供加密安全保护。如需真正的安全加密，请使用专业的加密算法。"},tips:{title:"使用技巧",items:[{icon:"💡",title:"快捷键支持",desc:"Ctrl+Enter 执行加密/解密，Ctrl+K 清空输入"},{icon:"🎨",title:"字体优化",desc:"密文区域使用等宽字体增强视觉混淆效果"},{icon:"📊",title:"实时验证",desc:"输入密文时会自动验证格式并显示状态"},{icon:"🔄",title:"可逆性保证",desc:"标准模式下加密解密完全可逆，无信息丢失"}]},specs:{title:"技术规格",items:[{label:"字符集",value:"O (大写O)、0 (数字零)、I (大写I)、l (小写L)"},{label:"编码方式",value:"UTF-8 → 二进制 → 2位分组映射"},{label:"压缩比",value:"约 4:1 (1字节 → 4字符)"},{label:"支持语言",value:"所有UTF-8字符，包括中文、英文、符号等"},{label:"浏览器支持",value:"现代浏览器，支持ES6+"}]},dataIntegrity:{title:"数据完整性保护",subtitle:"v2格式新增CRC32校验和，确保数据传输完整性",features:[{icon:"🛡️",title:"CRC32校验",desc:"自动计算并验证32位循环冗余校验码，检测数据传输错误"},{icon:"🔗",title:"无缝集成",desc:"校验码编码为O0Il格式，保持视觉连贯性，末尾16字符为校验码"},{icon:"🔄",title:"智能检测",desc:"自动识别新旧格式，确保向后兼容，旧格式仍可正常解密"},{icon:"⚡",title:"快速验证",desc:"解密时自动校验，CRC计算速度极快，几乎无性能影响"}]},formatCompare:{title:"格式对比",description:"oi1工具支持两种密文格式，新格式提供更好的数据保护",formats:[{version:"v1格式（旧）",structure:"纯O0Il密文",example:"0OIO0II0",protection:"仅视觉混淆"},{version:"v2格式（新）",structure:"O0Il密文 + CRC32校验码",example:"0OIO0II0O0lIO0Il00IlOOI0",protection:"视觉混淆 + 完整性验证"}],lengthNote:"新格式长度 = 原长度 + 16个校验字符"},statusGuide:{title:"校验状态说明",description:"解密时显示的不同状态含义",statuses:[{icon:"✓",status:"CRC32校验通过",meaning:"数据完整，未被损坏或篡改",action:"可放心使用解密结果"},{icon:"⚠",status:"旧版格式",meaning:"v1格式密文，无校验保护",action:"建议重新加密获得校验保护"},{icon:"✗",status:"校验失败",meaning:"数据可能在传输中损坏或被篡改",action:"请重新获取原始密文或检查输入"}]}},stats:{title:"统计信息",originalLength:"原文长度",cipherLength:"密文长度",compressionRatio:"压缩比",charDistribution:"字符分布",quality:"密文质量"},messages:{copySuccess:"已复制到剪贴板",copyError:"复制失败",encodeSuccess:"加密完成（已添加CRC32校验）",decodeSuccess:"解密完成",decodeSuccessWithCRC:"解密完成，CRC32校验通过",decodeSuccessLegacy:"解密完成（旧版格式，建议重新加密）",encodeError:"加密失败",decodeError:"解密失败",invalidInput:"输入无效",pasteSuccess:"已粘贴",pasteError:"粘贴失败",clearSuccess:"已清空"},errors:{notString:"输入必须是字符串",emptyInput:"输入不能为空",invalidChar:"包含无效字符 '{char}' (位置: {position})",encodingError:"加密过程中发生错误: {error}",decodingError:"解码过程中发生错误: {error}",validationError:"密文格式错误: {error}"},footer:{github:"GitHub",linkedin:"领英",email:"邮箱",copyright:"© 2025",rights:"保留所有权利"}},l={app:{title:"oi1 Visual Encoder",subtitle:"Visual Obfuscation Encryption Based on O0Il Similar Characters"},ui:{encrypt:"Encrypt",decrypt:"Decrypt",copy:"Copy",paste:"Paste",clear:"Clear",help:"Algorithm Guide",demo:"Demo",expand:"Expand",collapse:"Collapse",export:"Export",import:"Import",settings:"Settings"},encoder:{title:"Encoder",subtitle:"Convert text to O0Il characters",input:{label:"Plain Text Input",placeholder:"Enter text to encrypt..."},output:{label:"Cipher Text Output",placeholder:"Encryption result will appear here..."}},decoder:{title:"Decoder",subtitle:"Convert O0Il characters back to text",input:{label:"Cipher Text Input",placeholder:"Enter O0Il cipher text..."},output:{label:"Plain Text Output",placeholder:"Decryption result will appear here..."}},validation:{valid:"Cipher format is valid",invalid:"Cipher format is invalid",empty:"Input cannot be empty",invalidChar:"Contains invalid characters",invalidLength:"Incorrect length",crcVerified:"CRC32 verified, data intact",legacyFormat:"Legacy format (no checksum)",noCrc:"No CRC checksum"},demo:{title:"Algorithm Demonstration",toggle:"Toggle Demo",encoding:"Encoding Process",decoding:"Decoding Process",step:"Step",input:"Input",output:"Output",technical:"Technical Details",steps:{encoding:{step1:{title:"Text to UTF-8 Bytes",description:"Convert input text to UTF-8 encoded byte array"},step2:{title:"Calculate CRC32 Checksum",description:"Calculate CRC32 checksum for data integrity verification"},step3:{title:"Bytes to Binary",description:"Convert each byte to 8-bit binary number"},step4:{title:"Binary Grouping",description:"Group binary string into 2-bit segments for character mapping"},step5:{title:"Map to O0Il Characters",description:"Map each 2-bit binary group to corresponding visual obfuscation character"},step6:{title:"Append CRC32 Checksum",description:"Seamlessly append CRC32 checksum as O0Il characters to main cipher"}},decoding:{step1:{title:"Format Detection",description:"Detect cipher format version and determine if CRC32 checksum is included"},step2:{title:"Separate CRC32 Checksum",description:"Separate 16-character CRC32 checksum from end of v2 format cipher"},step3:{title:"Character Reverse Mapping",description:"Reverse map main cipher O0Il characters back to binary"},step4:{title:"Reassemble to Bytes",description:"Group binary string into 8-bit segments and convert to bytes"},step5:{title:"UTF-8 Decoding",description:"Decode byte array back to UTF-8 text"},step6:{title:"CRC32 Checksum Verification",description:"Calculate decoded text CRC32 and compare with cipher checksum"},legacyNote:{title:"Format Note",description:"v1 format cipher has no CRC32 checksum, cannot verify data integrity"}}}},help:{title:"oi1 Algorithm Principles",similarity:{title:"Visual Similarity Comparison",pairs:[{char1:"O",char2:"0",desc:"Uppercase O ↔ Digit Zero"},{char1:"I",char2:"l",desc:"Uppercase I ↔ Lowercase L"}]},mapping:{title:"Character Mapping",subtitle:"The algorithm converts text to binary, mapping each 2-bit binary to a character:",table:[{binary:"00",char:"O",desc:"Uppercase Letter O"},{binary:"01",char:"0",desc:"Digit Zero"},{binary:"10",char:"I",desc:"Uppercase Letter I"},{binary:"11",char:"l",desc:"Lowercase Letter L"}]},process:{title:"Encryption Process",steps:[{number:"1",title:"Text Input",desc:"Input any UTF-8 text"},{number:"2",title:"UTF-8 Encoding",desc:"Convert to byte array"},{number:"3",title:"Binary Conversion",desc:"Each byte to 8-bit binary"},{number:"4",title:"Character Mapping",desc:"Each 2-bit binary maps to O0Il character"},{number:"✓",title:"Cipher Output",desc:"Visual obfuscation text with O0Il only"}]},example:{title:"Encryption Example",subtitle:'Example: Encrypt "Hi"',steps:[{label:"Original:",value:'"Hi"'},{label:"UTF-8:",value:"[72, 105]"},{label:"Binary:",value:"01001000 01101001"},{label:"Grouped:",value:"01|00|10|00 01|10|10|01"},{label:"Mapped:",value:"0|O|I|O 0|I|I|0"},{label:"Cipher:",value:"0OIO0II0"}]},visual:{title:"Visual Effect Comparison",normal:"Normal Font: 0OIO0II0",mono:"Monospace Font: 0OIO0II0"},security:{title:"Security Features",features:[{icon:"🔒",title:"Local Processing",desc:"The encryption process executes entirely in the browser locally, without uploading any data. Supports offline use and protects privacy."},{icon:"👁️",title:"Visual Obfuscation",desc:"Hides real content through visually similar characters, suitable for scenarios requiring visual concealment."},{icon:"🔄",title:"Fully Reversible",desc:"Standard mode guarantees 100% reversibility with no information loss."}],warning:"Note: This tool is primarily for visual obfuscation and does not provide encryption security protection. For real security encryption, please use professional encryption algorithms."},tips:{title:"Usage Tips",items:[{icon:"💡",title:"Keyboard Shortcuts",desc:"Ctrl+Enter to encrypt/decrypt, Ctrl+K to clear input"},{icon:"🎨",title:"Font Optimization",desc:"Cipher area uses monospace font to enhance visual obfuscation"},{icon:"📊",title:"Real-time Validation",desc:"Automatically validates format and shows status when inputting cipher"},{icon:"🔄",title:"Reversibility Guarantee",desc:"Standard mode ensures completely reversible encryption/decryption with no information loss"}]},specs:{title:"Technical Specifications",items:[{label:"Character Set",value:"O (Uppercase O), 0 (Digit Zero), I (Uppercase I), l (Lowercase L)"},{label:"Encoding Method",value:"UTF-8 → Binary → 2-bit Group Mapping"},{label:"Compression Ratio",value:"Approx 4:1 (1 byte → 4 characters)"},{label:"Language Support",value:"All UTF-8 characters including Chinese, English, symbols, etc."},{label:"Browser Support",value:"Modern browsers supporting ES6+"}]},dataIntegrity:{title:"Data Integrity Protection",subtitle:"v2 format includes CRC32 checksum for transmission integrity assurance",features:[{icon:"🛡️",title:"CRC32 Checksum",desc:"Automatic calculation and verification of 32-bit cyclic redundancy check for data transmission error detection"},{icon:"🔗",title:"Seamless Integration",desc:"Checksum encoded as O0Il format, maintaining visual coherence, with last 16 characters as checksum"},{icon:"🔄",title:"Smart Detection",desc:"Automatic format recognition ensuring backward compatibility, legacy format still works normally"},{icon:"⚡",title:"Fast Verification",desc:"Automatic verification during decryption, CRC calculation is extremely fast with virtually no performance impact"}]},formatCompare:{title:"Format Comparison",description:"oi1 tool supports two cipher formats, new format provides better data protection",formats:[{version:"v1 format (legacy)",structure:"Pure O0Il cipher",example:"0OIO0II0",protection:"Visual obfuscation only"},{version:"v2 format (current)",structure:"O0Il cipher + CRC32 checksum",example:"0OIO0II0O0lIO0Il00IlOOI0",protection:"Visual obfuscation + integrity verification"}],lengthNote:"New format length = original length + 16 checksum characters"},statusGuide:{title:"Verification Status Guide",description:"Meaning of different statuses shown during decryption",statuses:[{icon:"✓",status:"CRC32 verified",meaning:"Data intact, not corrupted or tampered",action:"Safe to use decryption result"},{icon:"⚠",status:"Legacy format",meaning:"v1 format cipher, no checksum protection",action:"Recommend re-encryption for checksum protection"},{icon:"✗",status:"Verification failed",meaning:"Data may be corrupted during transmission or tampered",action:"Please re-obtain original cipher or check input"}]}},stats:{title:"Statistics",originalLength:"Original Length",cipherLength:"Cipher Length",compressionRatio:"Compression Ratio",charDistribution:"Character Distribution",quality:"Cipher Quality"},messages:{copySuccess:"Copied to clipboard",copyError:"Copy failed",encodeSuccess:"Encryption completed (CRC32 checksum added)",decodeSuccess:"Decryption completed",decodeSuccessWithCRC:"Decryption completed, CRC32 verified",decodeSuccessLegacy:"Decryption completed (legacy format, recommend re-encryption)",encodeError:"Encryption failed",decodeError:"Decryption failed",invalidInput:"Invalid input",pasteSuccess:"Pasted successfully",pasteError:"Paste failed",clearSuccess:"Cleared"},errors:{notString:"Input must be a string",emptyInput:"Input cannot be empty",invalidChar:"Contains invalid character '{char}' (position: {position})",encodingError:"Error during encoding: {error}",decodingError:"Error during decoding: {error}",validationError:"Cipher format error: {error}"},footer:{github:"GitHub",linkedin:"LinkedIn",email:"Email",copyright:"© 2024",rights:"All rights reserved"}};const d=new class{constructor(){this.languages={"zh-CN":c,"en-US":l},this.currentLang=this.detectLanguage(),this.currentMessages=this.languages[this.currentLang],this.applyLanguage()}detectLanguage(){const e=localStorage.getItem("oi1-language");if(e&&this.languages[e])return e;const t=navigator.language||navigator.userLanguage;return t.startsWith("zh")?"zh-CN":t.startsWith("en")?"en-US":"zh-CN"}t(e,t={}){const n=e.split(".");let i=this.currentMessages;for(const s of n){if(!i||"object"!=typeof i||!(s in i))return console.warn(`Translation key not found: ${e}`),e;i=i[s]}return"string"==typeof i||Array.isArray(i)||"object"==typeof i?Array.isArray(i)||"object"==typeof i?i:this.interpolate(i,t):(console.warn(`Translation key should resolve to string, array, or object: ${e}`),e)}interpolate(e,t){return e.replace(/{(\w+)}/g,(e,n)=>t.hasOwnProperty(n)?t[n]:e)}setLanguage(e){this.languages[e]?(this.currentLang=e,this.currentMessages=this.languages[e],localStorage.setItem("oi1-language",e),document.documentElement.lang=e,this.applyLanguage(),this.dispatchLanguageChangeEvent()):console.error(`Unsupported language: ${e}`)}getCurrentLanguage(){return this.currentLang}getAvailableLanguages(){return{"zh-CN":"中文","en-US":"English"}}applyLanguage(){document.querySelectorAll("[data-i18n]").forEach(e=>{const t=e.getAttribute("data-i18n");t&&(e.textContent=this.t(t))});document.querySelectorAll("[data-i18n-placeholder]").forEach(e=>{const t=e.getAttribute("data-i18n-placeholder");t&&(e.placeholder=this.t(t))});document.querySelectorAll("[data-i18n-title]").forEach(e=>{const t=e.getAttribute("data-i18n-title");t&&(e.title=this.t(t))}),document.title=this.t("app.title")}dispatchLanguageChangeEvent(){const e=new CustomEvent("languageChange",{detail:{language:this.currentLang,messages:this.currentMessages}});window.dispatchEvent(e)}formatNumber(e,t={}){const n="zh-CN"===this.currentLang?"zh-CN":"en-US";return new Intl.NumberFormat(n,t).format(e)}formatDate(e,t={}){const n="zh-CN"===this.currentLang?"zh-CN":"en-US";return new Intl.DateTimeFormat(n,t).format(e)}formatRelativeTime(e,t=new Date){const n="zh-CN"===this.currentLang?"zh-CN":"en-US",i=new Intl.RelativeTimeFormat(n,{numeric:"auto"}),s=Math.round((e-t)/1e3),a=Math.round(s/60),o=Math.round(a/60),r=Math.round(o/24);return Math.abs(s)<60?i.format(s,"second"):Math.abs(a)<60?i.format(a,"minute"):Math.abs(o)<24?i.format(o,"hour"):i.format(r,"day")}validateTranslations(){const e=[],t=Object.keys(this.languages),n=this._getFlatKeys(this.languages[t[0]]);for(let i=1;i<t.length;i++){const s=this._getFlatKeys(this.languages[t[i]]),a=n.filter(e=>!s.includes(e));a.length>0&&e.push({language:t[i],type:"missing_keys",keys:a});const o=s.filter(e=>!n.includes(e));o.length>0&&e.push({language:t[i],type:"extra_keys",keys:o})}return{isValid:0===e.length,issues:e}}_getFlatKeys(e,t=""){const n=[];for(const[i,s]of Object.entries(e)){const e=t?`${t}.${i}`:i;"object"!=typeof s||null===s||Array.isArray(s)?n.push(e):n.push(...this._getFlatKeys(s,e))}return n}},p={"00":"O","01":"0",10:"I",11:"l"},h={O:"00",0:"01",I:"10",l:"11"},u=new Set(["O","0","I","l"]);class m{constructor(){this.table=this._generateTable()}_generateTable(){const e=[];for(let t=0;t<256;t++){let n=t;for(let e=0;e<8;e++)1&n?n=n>>>1^3988292384:n>>>=1;e[t]=n>>>0}return e}calculate(e){let t=4294967295;for(let n=0;n<e.length;n++){const i=255&e[n];t=this.table[255&(t^i)]^t>>>8}return(4294967295^t)>>>0}toOI1String(e){const t=[e>>>24&255,e>>>16&255,e>>>8&255,255&e];let n="";for(const i of t){const e=i.toString(2).padStart(8,"0");for(let t=0;t<8;t+=2){const i=e.substring(t,t+2);n+=p[i]}}return n}fromOI1String(e){if(16!==e.length)throw new Error("CRC32字符串长度必须为16");let t="";for(const i of e){if(!h[i])throw new Error(`无效的O0Il字符: ${i}`);t+=h[i]}let n=0;for(let i=0;i<32;i++)"1"===t[i]&&(n|=1<<31-i);return n>>>0}}class g{constructor(){this.crc32=new m}encode(e){if("string"!=typeof e)throw new Error("输入必须是字符串");if(!e)return"";try{const t=(new TextEncoder).encode(e),n=this.crc32.calculate(t),i=this.crc32.toOI1String(n);let s="";for(const e of t)s+=e.toString(2).padStart(8,"0");return this._binaryToChars(s)+i}catch(t){throw new Error(`加密过程中发生错误: ${t.message}`)}}_binaryToChars(e){const t=(2-e.length%2)%2,n=e+"0".repeat(t);let i="";for(let s=0;s<n.length;s+=2){const e=n.substring(s,s+2);i+=p[e]}return i}detectFormat(e){if(!e||"string"!=typeof e)return{version:"unknown",hasCRC:!1,isValid:!1};const t=e.length;return t>16&&(t-16)%4==0?{version:"v2",hasCRC:!0,isValid:!0,mainCipherLength:t-16,crcLength:16}:t%4==0&&t>0?{version:"v1",hasCRC:!1,isValid:!0,mainCipherLength:t,crcLength:0}:{version:"unknown",hasCRC:!1,isValid:!1}}getEncodingStats(e,t){const n=(new TextEncoder).encode(e),i=this.detectFormat(t);return{originalLength:e.length,originalBytes:n.length,cipherLength:t.length,compressionRatio:t.length/e.length,bytesRatio:t.length/n.length,formatVersion:i.version,hasCRC:i.hasCRC,crcValue:i.hasCRC?this._getCRCFromCipher(t):null,charDistribution:this._getCharDistribution(t)}}_getCRCFromCipher(e){const t=this.detectFormat(e);return t.hasCRC&&"v2"===t.version?e.slice(-16):null}_getCharDistribution(e){const t={O:0,0:0,I:0,l:0};for(const s of e)t.hasOwnProperty(s)&&t[s]++;const n=e.length,i={};for(const[s,a]of Object.entries(t))i[s]=n>0?(a/n*100).toFixed(1):0;return{counts:t,percentages:i,total:n}}}class y{constructor(){this.crc32=new m,this.encoder=new g}decode(e){if("string"!=typeof e)throw new Error("输入必须是字符串");if(!e)return{plaintext:"",crcVerified:!1,formatVersion:"empty"};const t=this.encoder.detectFormat(e);if(!t.isValid)throw new Error("密文格式不正确，无法识别版本");const n=this.validateCiphertext(e);if(!n.isValid)throw new Error(`密文格式错误: ${n.error}`);try{return"v2"===t.version?this._decodeWithCRC(e,t):this._decodeWithoutCRC(e,t)}catch(i){throw new Error(`解码过程中发生错误: ${i.message}`)}}_decodeWithCRC(e,t){const n=e.slice(0,t.mainCipherLength),i=e.slice(-16),s=this.crc32.fromOI1String(i),a=this._decodeCipher(n),o=(new TextEncoder).encode(a),r=this.crc32.calculate(o);if(!(r===s))throw new Error(`CRC32校验失败！数据可能已损坏或被篡改。期望: ${s.toString(16).toUpperCase()}, 实际: ${r.toString(16).toUpperCase()}`);return{plaintext:a,crcVerified:!0,formatVersion:"v2",crcExpected:s,crcActual:r}}_decodeWithoutCRC(e,t){return{plaintext:this._decodeCipher(e),crcVerified:!1,formatVersion:"v1",crcExpected:null,crcActual:null}}_decodeCipher(e){let t="";for(const o of e)t+=h[o];const n=[];for(let o=0;o<t.length;o+=8){const e=t.substring(o,o+8);8===e.length&&n.push(parseInt(e,2))}const i=new Uint8Array(n),s=new TextDecoder("utf-8",{fatal:!0});try{return s.decode(i)}catch(a){const e=n.map(e=>`${e}(0x${e.toString(16)})`).join(", ");throw new Error(`UTF-8解码失败，字节序列可能无效: [${e}]. 原始错误: ${a.message}`)}}validateCiphertext(e){if(!e||"string"!=typeof e)return{isValid:!1,error:"密文不能为空"};for(let t=0;t<e.length;t++){const n=e[t];if(!u.has(n))return{isValid:!1,error:`包含无效字符 '${n}' (位置: ${t+1})`}}return{isValid:!0,error:null}}getCiphertextQuality(e){const t=this.validateCiphertext(e);if(!t.isValid)return{quality:0,issues:[t.error],recommendations:["请检查密文格式"]};const n=this._getCharDistribution(e),i=[],s=[];let a=100;const o=Object.values(n.percentages).map(e=>parseFloat(e));return this._calculateVariance(o)>300&&(a-=20,i.push("字符分布不均匀"),s.push("考虑使用混合模式提高分布均匀性")),e.length<8&&(a-=10,i.push("密文长度较短")),this._hasObviousPatterns(e)&&(a-=15,i.push("存在明显的重复模式"),s.push("原文可能包含重复内容")),{quality:Math.max(0,a),distribution:n,issues:i,recommendations:s}}_calculateVariance(e){const t=e.reduce((e,t)=>e+t,0)/e.length;return e.reduce((e,n)=>e+Math.pow(n-t,2),0)/e.length}_hasObviousPatterns(e){for(let n=0;n<e.length-3;n++)if(e[n]===e[n+1]&&e[n]===e[n+2]&&e[n]===e[n+3])return!0;let t=0;for(let n=0;n<e.length-1;n++)n>0&&e[n]===e[n-2]&&e[n]!==e[n-1]&&t++;return t>.3*e.length}_getCharDistribution(e){const t={O:0,0:0,I:0,l:0};for(const s of e)t.hasOwnProperty(s)&&t[s]++;const n=e.length,i={};for(const[s,a]of Object.entries(t))i[s]=n>0?(a/n*100).toFixed(1):0;return{counts:t,percentages:i,total:n}}}class v{static generateEncodingDemo(e){if(!e)return[];const t=[],n=new g;try{const i=(new TextEncoder).encode(e);t.push({step:1,title:d.t("demo.steps.encoding.step1.title"),description:d.t("demo.steps.encoding.step1.description"),input:e,output:Array.from(i).map(e=>e.toString()).join(", "),technical:`字节数组: [${Array.from(i).join(", ")}]`});const s=n.crc32.calculate(i),a=n.crc32.toOI1String(s);t.push({step:2,title:d.t("demo.steps.encoding.step2.title"),description:d.t("demo.steps.encoding.step2.description"),input:`[${Array.from(i).join(", ")}]`,output:`CRC32: 0x${s.toString(16).toUpperCase()}`,technical:`CRC32(O0Il): ${a} (16${d.t("validation.chars")||"字符"})`});let o="";const r=[];for(const e of i){const t=e.toString(2).padStart(8,"0");r.push(t),o+=t}t.push({step:3,title:d.t("demo.steps.encoding.step3.title"),description:d.t("demo.steps.encoding.step3.description"),input:Array.from(i).join(", "),output:r.join(" "),technical:`完整二进制串: ${o} (${o.length}位)`});const c=[];for(let e=0;e<o.length;e+=2)c.push(o.substring(e,e+2));t.push({step:4,title:d.t("demo.steps.encoding.step4.title"),description:d.t("demo.steps.encoding.step4.description"),input:o,output:c.join(" | "),technical:`分组数量: ${c.length}`});const l=[];for(const e of c){const t=p[e]||"?";l.push(`${e}→${t}`)}const h=c.map(e=>p[e]||"?").join("");t.push({step:5,title:d.t("demo.steps.encoding.step5.title"),description:d.t("demo.steps.encoding.step5.description"),input:c.join(" "),output:l.join(" "),technical:`主密文: ${h} (${h.length}字符)`});const u=h+a;return t.push({step:6,title:d.t("demo.steps.encoding.step6.title"),description:d.t("demo.steps.encoding.step6.description"),input:`主密文: ${h}\nCRC32: ${a}`,output:u,technical:`最终密文(v2): ${u} (${u.length}字符) = ${h.length}主密文 + 16CRC`}),t}catch(i){return[{step:0,title:d.t("errors.error")||"错误",description:d.t("demo.errorGeneration")||"演示生成失败",input:e,output:i.message,technical:""}]}}static generateDecodingDemo(e){if(!e)return[];const t=[],n=new y;try{const i=n.validateCiphertext(e);if(!i.isValid)return[{step:0,title:d.t("validation.invalid")||"验证失败",description:d.t("demo.validationFailed")||"密文格式不正确",input:e,output:i.error,technical:""}];const s=n.encoder.detectFormat(e);t.push({step:1,title:d.t("demo.steps.decoding.step1.title"),description:d.t("demo.steps.decoding.step1.description"),input:`密文长度: ${e.length}`,output:`格式: ${s.version} ${s.hasCRC?"(包含CRC32)":"(无CRC)"}`,technical:`主密文: ${s.mainCipherLength}字符, CRC: ${s.crcLength}字符`});let a=e,o="",r=null;"v2"===s.version&&s.hasCRC&&(a=e.slice(0,s.mainCipherLength),o=e.slice(-16),r=n.crc32.fromOI1String(o),t.push({step:2,title:d.t("demo.steps.decoding.step2.title"),description:d.t("demo.steps.decoding.step2.description"),input:e,output:`主密文: ${a}\nCRC32: ${o}`,technical:`CRC32值: 0x${r.toString(16).toUpperCase()}`}));const c=[];let l="";for(const e of a){const t=h[e];c.push(`${e}→${t}`),l+=t}t.push({step:s.hasCRC?3:2,title:d.t("demo.steps.decoding.step3.title"),description:d.t("demo.steps.decoding.step3.description"),input:a,output:c.join(" "),technical:`完整二进制串: ${l} (${l.length}位)`});const p=[],u=[];for(let e=0;e<l.length;e+=8){const t=l.substring(e,e+8);if(8===t.length){const e=parseInt(t,2);p.push(`${t}(${e})`),u.push(e)}}t.push({step:s.hasCRC?4:3,title:d.t("demo.steps.decoding.step4.title"),description:d.t("demo.steps.decoding.step4.description"),input:l,output:p.join(" "),technical:`字节数组: [${u.join(", ")}]`});const m=new Uint8Array(u),g=new TextDecoder("utf-8").decode(m);if(t.push({step:s.hasCRC?5:4,title:d.t("demo.steps.decoding.step5.title"),description:d.t("demo.steps.decoding.step5.description"),input:`[${u.join(", ")}]`,output:g,technical:`解码成功，共${g.length}个字符`}),"v2"===s.version&&s.hasCRC&&null!==r){const e=(new TextEncoder).encode(g),i=n.crc32.calculate(e),s=i===r;t.push({step:6,title:d.t("demo.steps.decoding.step6.title"),description:d.t("demo.steps.decoding.step6.description"),input:`期望CRC32: 0x${r.toString(16).toUpperCase()}\n实际CRC32: 0x${i.toString(16).toUpperCase()}`,output:s?"✓ CRC32校验通过 - 数据完整无误":"✗ CRC32校验失败 - 数据可能损坏或被篡改",technical:`校验结果: ${s?"通过":"失败"} - ${s?"数据完整性得到保证":"检测到数据损坏或篡改"}`})}else"v1"===s.version&&t.push({step:5,title:d.t("demo.steps.decoding.legacyNote.title"),description:d.t("demo.steps.decoding.legacyNote.description"),input:"旧格式密文",output:"⚠️ 无完整性保护 - 建议使用v2格式",technical:"v1格式为向后兼容保留，推荐升级到v2格式获得完整性保护"});return t}catch(i){return[{step:0,title:d.t("errors.error")||"错误",description:d.t("demo.errorGeneration")||"演示生成失败",input:e,output:i.message,technical:""}]}}}class C{constructor(){this.isModernAPI=this.checkModernAPISupport()}checkModernAPISupport(){return"undefined"!=typeof navigator&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText&&"function"==typeof navigator.clipboard.readText}copy(e){return r(this,null,function*(){if("string"!=typeof e)throw new Error("Text must be a string");return this.isModernAPI?yield this.copyModern(e):yield this.copyLegacy(e)})}paste(){return r(this,null,function*(){return this.isModernAPI?yield this.pasteModern():yield this.pasteLegacy()})}copyModern(e){return r(this,null,function*(){try{yield navigator.clipboard.writeText(e)}catch(t){return console.warn("Modern clipboard API failed, falling back to legacy method:",t),yield this.copyLegacy(e)}})}pasteModern(){return r(this,null,function*(){try{return yield navigator.clipboard.readText()}catch(e){return console.warn("Modern clipboard API failed, falling back to legacy method:",e),yield this.pasteLegacy()}})}copyLegacy(e){return r(this,null,function*(){return new Promise((t,n)=>{try{const i=document.createElement("textarea");i.value=e,i.style.position="fixed",i.style.left="-999999px",i.style.top="-999999px",i.style.opacity="0",i.style.pointerEvents="none",document.body.appendChild(i),i.focus(),i.select(),i.setSelectionRange(0,e.length);const s=document.execCommand("copy");document.body.removeChild(i),s?t():n(new Error("Copy command was unsuccessful"))}catch(i){n(new Error(`Legacy copy failed: ${i.message}`))}})})}pasteLegacy(){return r(this,null,function*(){return new Promise((e,t)=>{t(new Error("Legacy paste not supported. Please use Ctrl+V manually."))})})}checkPermission(){return r(this,null,function*(){if(!this.isModernAPI)return"legacy";try{return(yield navigator.permissions.query({name:"clipboard-read"})).state}catch(e){return console.warn("Cannot check clipboard permission:",e),"unknown"}})}copyRich(e,t){return r(this,null,function*(){if(!this.isModernAPI)return yield this.copyLegacy(t);try{const n=new ClipboardItem({"text/html":new Blob([e],{type:"text/html"}),"text/plain":new Blob([t],{type:"text/plain"})});yield navigator.clipboard.write([n])}catch(n){return console.warn("Rich text copy failed, falling back to plain text:",n),yield this.copyModern(t)}})}copyImage(e){return r(this,null,function*(){if(!this.isModernAPI)throw new Error("Image copying is not supported in legacy browsers");try{const t=new ClipboardItem({[e.type]:e});yield navigator.clipboard.write([t])}catch(t){throw new Error(`Image copy failed: ${t.message}`)}})}getSupportedTypes(){return r(this,null,function*(){if(!this.isModernAPI)return["text/plain"];try{const e=yield navigator.clipboard.read();return e.length>0?e[0].types:[]}catch(e){return console.warn("Cannot get clipboard types:",e),["text/plain"]}})}onClipboardChange(e){let t="",n=!0;const i=()=>r(this,null,function*(){if(n){try{const n=yield this.paste();n!==t&&(t=n,e(n))}catch(s){}setTimeout(i,1e3)}});return i(),()=>{n=!1}}getStatus(){return r(this,null,function*(){const e={isSupported:this.isModernAPI,permission:yield this.checkPermission(),supportedTypes:yield this.getSupportedTypes(),canRead:!1,canWrite:!1};try{yield this.copy("test"),e.canWrite=!0}catch(t){e.canWrite=!1}try{yield this.paste(),e.canRead=!0}catch(t){e.canRead=!1}return e})}}new C;class f{constructor(){this.container=null,this.isInitialized=!1,this.currentDemo=null,this.animationSpeed=1e3}init(e){return r(this,null,function*(){this.isInitialized||(this.container=e,this.createDemoStructure(),this.bindEvents(),this.isInitialized=!0)})}createDemoStructure(){this.container&&(this.container.innerHTML='\n            <div class="demo-controls">\n                <div class="demo-tabs">\n                    <button class="demo-tab active" data-tab="encoding" data-i18n="demo.encoding">编码过程</button>\n                    <button class="demo-tab" data-tab="decoding" data-i18n="demo.decoding">解码过程</button>\n                </div>\n            </div>\n            \n            <div class="demo-content-area">\n                <div id="encodingDemo" class="demo-panel active">\n                    <div class="demo-steps" id="encodingSteps"></div>\n                </div>\n                \n                <div id="decodingDemo" class="demo-panel">\n                    <div class="demo-steps" id="decodingSteps"></div>\n                </div>\n            </div>\n            \n            <div class="demo-footer">\n                <div class="demo-status" id="demoStatus"></div>\n            </div>\n        ',d.applyLanguage())}bindEvents(){if(!this.container)return;this.container.querySelectorAll(".demo-tab").forEach(e=>{e.addEventListener("click",e=>{this.switchTab(e.target.dataset.tab)})})}switchTab(e){if(!this.container)return;this.container.querySelectorAll(".demo-tab").forEach(t=>{t.dataset.tab===e?t.classList.add("active"):t.classList.remove("active")});this.container.querySelectorAll(".demo-panel").forEach(t=>{t.id===`${e}Demo`?t.classList.add("active"):t.classList.remove("active")})}showEncodingDemo(e){return r(this,null,function*(){if(!this.container||!e)return;const t=v.generateEncodingDemo(e),n=this.container.querySelector("#encodingSteps");n&&(this.currentDemo={type:"encoding",text:e,steps:t},yield this.renderSteps(n,t,"encoding"),this.updateStatus(`编码演示：${e} → ${t.length}个步骤`))})}showDecodingDemo(e){return r(this,null,function*(){if(!this.container||!e)return;const t=v.generateDecodingDemo(e),n=this.container.querySelector("#decodingSteps");n&&(this.currentDemo={type:"decoding",text:e,steps:t},yield this.renderSteps(n,t,"decoding"),this.updateStatus(`解码演示：${e.substring(0,20)}... → ${t.length}个步骤`))})}renderSteps(e,t,n){return r(this,null,function*(){if(e){e.innerHTML="";for(let n=0;n<t.length;n++){const i=t[n],s=this.createStepElement(i,n);e.appendChild(s)}}})}createStepElement(e,t){const n=document.createElement("div");n.className="demo-step",n.dataset.step=e.step;const i=0===e.step;return i&&n.classList.add("error"),n.innerHTML=`\n            <div class="step-header">\n                <div class="step-number">${i?"⚠️":e.step}</div>\n                <div class="step-title">\n                    <h4>${e.title}</h4>\n                    <p class="step-description">${e.description}</p>\n                </div>\n            </div>\n            \n            <div class="step-content">\n                <div class="step-io">\n                    <div class="step-input">\n                        <label>${d.t("demo.input")}:</label>\n                        <div class="step-data${e.step>2?" cipher-display":""}">${this.escapeHtml(e.input)}</div>\n                    </div>\n                    \n                    <div class="step-arrow">→</div>\n                    \n                    <div class="step-output">\n                        <label>${d.t("demo.output")}:</label>\n                        <div class="step-data${e.step>2?" cipher-display":""}">${this.escapeHtml(e.output)}</div>\n                    </div>\n                </div>\n                \n                ${e.technical?`\n                    <div class="step-technical">\n                        <details>\n                            <summary>${d.t("demo.technical")}</summary>\n                            <div class="technical-details">${this.escapeHtml(e.technical)}</div>\n                        </details>\n                    </div>\n                `:""}\n            </div>\n        `,n}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}updateStatus(e){var t;const n=null==(t=this.container)?void 0:t.querySelector("#demoStatus");n&&(n.textContent=e)}highlightStep(e){if(!this.container)return;this.container.querySelectorAll(".demo-step").forEach(t=>{parseInt(t.dataset.step)===e&&(t.classList.add("highlighted"),t.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{t.classList.remove("highlighted")},3e3))})}exportDemo(){return this.currentDemo?(e=((e,t)=>{for(var n in t||(t={}))s.call(t,n)&&o(e,n,t[n]);if(i)for(var n of i(t))a.call(t,n)&&o(e,n,t[n]);return e})({},this.currentDemo),r={timestamp:(new Date).toISOString(),version:"1.0"},t(e,n(r))):null;var e,r}generateReport(){if(!this.currentDemo)return"<p>没有可用的演示数据</p>";const{type:e,text:t,steps:n}=this.currentDemo;let i=`\n            <div class="demo-report">\n                <h3>oi1 ${"encoding"===e?"编码":"解码"}演示报告</h3>\n                <p><strong>输入文本：</strong> ${this.escapeHtml(t)}</p>\n                <p><strong>步骤数量：</strong> ${n.length}</p>\n                <p><strong>生成时间：</strong> ${(new Date).toLocaleString()}</p>\n                \n                <div class="report-steps">\n        `;return n.forEach(e=>{i+=`\n                <div class="report-step">\n                    <h4>步骤 ${e.step}: ${e.title}</h4>\n                    <p>${e.description}</p>\n                    <div class="report-step-data">\n                        <p><strong>输入：</strong> <code>${this.escapeHtml(e.input)}</code></p>\n                        <p><strong>输出：</strong> <code>${this.escapeHtml(e.output)}</code></p>\n                        ${e.technical?`<p><strong>技术详情：</strong> ${this.escapeHtml(e.technical)}</p>`:""}\n                    </div>\n                </div>\n            `}),i+="\n                </div>\n            </div>\n        ",i}clear(){if(!this.container)return;const e=this.container.querySelector("#encodingSteps"),t=this.container.querySelector("#decodingSteps");e&&(e.innerHTML=""),t&&(t.innerHTML=""),this.currentDemo=null,this.updateStatus("演示已清空")}destroy(){this.container&&(this.container.innerHTML=""),this.container=null,this.currentDemo=null,this.isInitialized=!1}}class b{constructor(){this.modal=null,this.isInitialized=!1,this.isVisible=!1}init(){return r(this,null,function*(){this.isInitialized||(this.createModal(),this.bindEvents(),this.isInitialized=!0)})}createModal(){this.modal=document.getElementById("helpModal"),this.modal||(this.modal=document.createElement("div"),this.modal.id="helpModal",this.modal.className="modal",document.body.appendChild(this.modal)),this.modal.innerHTML=`\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h3 data-i18n="help.title">oi1 算法原理</h3>\n                    <button id="closeModal" class="modal-close">&times;</button>\n                </div>\n                <div class="modal-body">\n                    ${this.generateHelpContent()}\n                </div>\n            </div>\n        `,d.applyLanguage()}generateHelpContent(){const e=this.generateSimilaritySection(),t=this.generateMappingTable(),n=this.generateProcessFlow(),i=this.generateExampleDemo(),s=this.generateVisualComparison(),a=this.generateDataIntegritySection(),o=this.generateFormatComparisonSection(),r=this.generateStatusGuideSection(),c=this.generateSecurityInfo(),l=this.generateTipsSection(),p=this.generateSpecsSection();return`\n            <div class="help-content">\n                \x3c!-- 视觉相似性对比 --\x3e\n                ${e}\n\n                \x3c!-- 字符映射 --\x3e\n                <section class="help-section">\n                    <h4>${d.t("help.mapping.title")}</h4>\n                    <p>${d.t("help.mapping.subtitle")}</p>\n                    ${t}\n                </section>\n\n                \x3c!-- 加密流程 --\x3e\n                ${n}\n\n                \x3c!-- 示例演示 --\x3e\n                ${i}\n\n                \x3c!-- 数据完整性保护 --\x3e\n                ${a}\n\n                \x3c!-- 格式对比 --\x3e\n                ${o}\n\n                \x3c!-- 校验状态说明 --\x3e\n                ${r}\n\n                \x3c!-- 视觉效果对比 --\x3e\n                ${s}\n\n                \x3c!-- 安全特性 --\x3e\n                ${c}\n\n                \x3c!-- 使用技巧 --\x3e\n                ${l}\n\n                \x3c!-- 技术规格 --\x3e\n                ${p}\n            </div>\n        `}generateSimilaritySection(){var e,t;const n=(null==(t=null==(e=d.currentMessages.help)?void 0:e.similarity)?void 0:t.pairs)||[];return`\n            <section class="help-section">\n                <h4>${d.t("help.similarity.title")}</h4>\n                <div class="visual-similarity">\n                    <div class="char-comparison">\n                        ${n.map(e=>`\n                            <div class="char-pair">\n                                <span class="char-display large">${e.char1}</span>\n                                <span class="vs">vs</span>\n                                <span class="char-display large">${e.char2}</span>\n                                <div class="similarity-note">${e.desc}</div>\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n            </section>\n        `}generateProcessFlow(){var e,t;const n=(null==(t=null==(e=d.currentMessages.help)?void 0:e.process)?void 0:t.steps)||[];return`\n            <section class="help-section">\n                <h4>${d.t("help.process.title")}</h4>\n                <div class="flow-diagram">\n                    ${n.map((e,t)=>`\n                        <div class="flow-step ${"✓"===e.number?"final":""}">\n                            <div class="flow-number">${e.number}</div>\n                            <div class="flow-content">\n                                <strong>${e.title}</strong>\n                                <p>${e.desc}</p>\n                            </div>\n                        </div>\n                        ${t<n.length-1?'<div class="flow-arrow">↓</div>':""}\n                    `).join("")}\n                </div>\n            </section>\n        `}generateVisualComparison(){const e=d.t("help.visual.normal"),t=d.t("help.visual.mono"),n=e=>{const t=e.split("：");return{label:t[0]||"",value:t[1]||"0OIO0II0"}},i=n(e),s=n(t);return`\n            <section class="help-section">\n                <h4>${d.t("help.visual.title")}</h4>\n                <div class="visual-comparison">\n                    <div class="comparison-item">\n                        <span class="comparison-label">${i.label}：</span>\n                        <span class="comparison-value">${i.value}</span>\n                    </div>\n                    <div class="comparison-item">\n                        <span class="comparison-label">${s.label}：</span>\n                        <span class="comparison-value cipher-display">${s.value}</span>\n                    </div>\n                </div>\n            </section>\n        `}generateTipsSection(){var e,t;const n=(null==(t=null==(e=d.currentMessages.help)?void 0:e.tips)?void 0:t.items)||[];return`\n            <section class="help-section">\n                <h4>${d.t("help.tips.title")}</h4>\n                <div class="tips-list">\n                    ${n.map(e=>`\n                        <div class="tip-item">\n                            <span class="tip-icon">${e.icon}</span>\n                            <div class="tip-content">\n                                <strong>${e.title}：</strong>\n                                <p>${e.desc}</p>\n                            </div>\n                        </div>\n                    `).join("")}\n                </div>\n            </section>\n        `}generateSpecsSection(){var e,t;const n=(null==(t=null==(e=d.currentMessages.help)?void 0:e.specs)?void 0:t.items)||[];return`\n            <section class="help-section">\n                <h4>${d.t("help.specs.title")}</h4>\n                <div class="tech-specs">\n                    ${n.map(e=>`\n                        <div class="spec-row">\n                            <span class="spec-label">${e.label}：</span>\n                            <span class="spec-value">${e.value}</span>\n                        </div>\n                    `).join("")}\n                </div>\n            </section>\n        `}generateMappingTable(){var e,t;return`\n            <div class="mapping-table">\n                <table>\n                    <thead>\n                        <tr>\n                            <th>二进制</th>\n                            <th>字符</th>\n                            <th>描述</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ${((null==(t=null==(e=d.currentMessages.help)?void 0:e.mapping)?void 0:t.table)||[]).map(e=>`\n                            <tr>\n                                <td><code>${e.binary}</code></td>\n                                <td><span class="char-display">${e.char}</span></td>\n                                <td>${e.desc}</td>\n                            </tr>\n                        `).join("")}\n                    </tbody>\n                </table>\n            </div>\n        `}generateExampleDemo(){var e,t;const n=null==(e=d.currentMessages.help)?void 0:e.example;return n?`\n            <section class="help-section">\n                <h4>${n.title}</h4>\n                <div class="example-demo">\n                    <div class="example-item">\n                        <h5>${n.subtitle}</h5>\n                        <div class="example-steps">\n                            ${(null==(t=n.steps)?void 0:t.map(e=>`\n                                <div class="example-step">\n                                    <span class="step-label">${e.label}</span>\n                                    <span class="step-value ${"密文："===e.label?"cipher-display":""}">${e.value}</span>\n                                </div>\n                            `).join(""))||""}\n                        </div>\n                    </div>\n                </div>\n            </section>\n        `:""}generateSecurityInfo(){var e,t;const n=null==(e=d.currentMessages.help)?void 0:e.security;return n?`\n            <section class="help-section">\n                <h4>${n.title}</h4>\n                <div class="security-info">\n                    ${(null==(t=n.features)?void 0:t.map(e=>`\n                        <div class="security-feature">\n                            <span class="security-icon">${e.icon}</span>\n                            <div class="security-content">\n                                <strong>${e.title}：</strong>\n                                <p>${e.desc}</p>\n                            </div>\n                        </div>\n                    `).join(""))||""}\n                    \n                    ${n.warning?`\n                        <div class="security-note">\n                            <strong>注意：</strong> ${n.warning}\n                        </div>\n                    `:""}\n                </div>\n            </section>\n        `:""}bindEvents(){if(!this.modal)return;const e=this.modal.querySelector("#closeModal");e&&e.addEventListener("click",()=>this.hide()),this.modal.addEventListener("click",e=>{e.target===this.modal&&this.hide()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isVisible&&this.hide()}),window.addEventListener("languageChange",()=>{this.isVisible&&this.updateContent()})}show(){if(!this.modal)return;this.modal.style.display="flex",this.isVisible=!0,document.body.style.overflow="hidden";const e=this.modal.querySelector("#closeModal");e&&e.focus()}hide(){this.modal&&(this.modal.style.display="none",this.isVisible=!1,document.body.style.overflow="")}toggle(){this.isVisible?this.hide():this.show()}generateDataIntegritySection(){const e=d.t("help.dataIntegrity.features"),t=(Array.isArray(e)?e:[]).map(e=>`\n            <div class="feature-item">\n                <span class="feature-icon">${e.icon||"🔧"}</span>\n                <div class="feature-content">\n                    <h5>${e.title||"Feature"}</h5>\n                    <p>${e.desc||"Description"}</p>\n                </div>\n            </div>\n        `).join("");return`\n            <section class="help-section">\n                <h4>${d.t("help.dataIntegrity.title")}</h4>\n                <p class="section-subtitle">${d.t("help.dataIntegrity.subtitle")}</p>\n                <div class="features-grid">\n                    ${t}\n                </div>\n            </section>\n        `}generateFormatComparisonSection(){const e=d.t("help.formatCompare.formats"),t=(Array.isArray(e)?e:[]).map(e=>`\n            <div class="format-item">\n                <h5 class="format-version">${e.version||"Format"}</h5>\n                <div class="format-structure">${e.structure||"Structure"}</div>\n                <div class="format-example cipher-display">${e.example||"Example"}</div>\n                <div class="format-protection">${e.protection||"Protection"}</div>\n            </div>\n        `).join("");return`\n            <section class="help-section">\n                <h4>${d.t("help.formatCompare.title")}</h4>\n                <p class="section-subtitle">${d.t("help.formatCompare.description")}</p>\n                <div class="formats-comparison">\n                    ${t}\n                </div>\n                <p class="format-note">${d.t("help.formatCompare.lengthNote")}</p>\n            </section>\n        `}generateStatusGuideSection(){const e=d.t("help.statusGuide.statuses"),t=(Array.isArray(e)?e:[]).map(e=>`\n            <div class="status-item">\n                <span class="status-icon">${e.icon||"📌"}</span>\n                <div class="status-content">\n                    <h5 class="status-title">${e.status||"Status"}</h5>\n                    <p class="status-meaning">${e.meaning||"Meaning"}</p>\n                    <p class="status-action">${e.action||"Action"}</p>\n                </div>\n            </div>\n        `).join("");return`\n            <section class="help-section">\n                <h4>${d.t("help.statusGuide.title")}</h4>\n                <p class="section-subtitle">${d.t("help.statusGuide.description")}</p>\n                <div class="status-guide">\n                    ${t}\n                </div>\n            </section>\n        `}updateContent(){if(!this.modal)return;const e=this.modal.querySelector(".modal-body");e&&(e.innerHTML=this.generateHelpContent()),d.applyLanguage()}destroy(){this.modal&&this.modal.parentNode&&this.modal.parentNode.removeChild(this.modal),this.modal=null,this.isInitialized=!1,this.isVisible=!1,document.body.style.overflow=""}}(new class{constructor(){this.encoder=new g,this.decoder=new y,this.clipboard=new C,this.demoViewer=new f,this.helpModal=new b,this.elements={},this.isInitialized=!1,this.handleEncode=this.handleEncode.bind(this),this.handleDecode=this.handleDecode.bind(this),this.handleLanguageChange=this.handleLanguageChange.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.handleCipherInputChange=this.handleCipherInputChange.bind(this)}init(){return r(this,null,function*(){if(!this.isInitialized)try{"loading"===document.readyState&&(yield new Promise(e=>{document.addEventListener("DOMContentLoaded",e)})),this.initElements(),this.bindEventListeners(),yield this.initComponents(),this.applyInitialState(),this.isInitialized=!0,console.log("oi1 App initialized successfully")}catch(e){console.error("Failed to initialize oi1 App:",e),this.showError("应用程序初始化失败",e.message)}})}initElements(){this.elements.plaintext=document.getElementById("plaintext"),this.elements.ciphertext=document.getElementById("ciphertext"),this.elements.cipherInput=document.getElementById("cipherInput"),this.elements.plaintextOutput=document.getElementById("plaintextOutput"),this.elements.encodeBtn=document.getElementById("encodeBtn"),this.elements.decodeBtn=document.getElementById("decodeBtn"),this.elements.clearPlainBtn=document.getElementById("clearPlainBtn"),this.elements.clearCipherBtn=document.getElementById("clearCipherBtn"),this.elements.copyCipherBtn=document.getElementById("copyCipherBtn"),this.elements.copyPlainBtn=document.getElementById("copyPlainBtn"),this.elements.pasteBtn=document.getElementById("pasteBtn"),this.elements.helpBtn=document.getElementById("helpBtn"),this.elements.languageSelect=document.getElementById("languageSelect"),this.elements.plaintextCount=document.getElementById("plaintextCount"),this.elements.ciphertextCount=document.getElementById("ciphertextCount"),this.elements.cipherInputCount=document.getElementById("cipherInputCount"),this.elements.plaintextOutputCount=document.getElementById("plaintextOutputCount"),this.elements.validationStatus=document.getElementById("validationStatus"),this.elements.errorMessage=document.getElementById("errorMessage"),this.elements.toggleDemo=document.getElementById("toggleDemo"),this.elements.demoContent=document.getElementById("demoContent");const e=["plaintext","ciphertext","cipherInput","plaintextOutput","encodeBtn","decodeBtn","languageSelect"];for(const t of e)if(!this.elements[t])throw new Error(`Required element not found: ${t}`)}bindEventListeners(){this.elements.encodeBtn.addEventListener("click",this.handleEncode),this.elements.decodeBtn.addEventListener("click",this.handleDecode),this.elements.clearPlainBtn.addEventListener("click",()=>this.clearInput("plaintext")),this.elements.clearCipherBtn.addEventListener("click",()=>this.clearInput("cipherInput")),this.elements.copyCipherBtn.addEventListener("click",()=>this.copyText("ciphertext")),this.elements.copyPlainBtn.addEventListener("click",()=>this.copyText("plaintextOutput")),this.elements.pasteBtn.addEventListener("click",()=>this.pasteText("cipherInput")),this.elements.helpBtn.addEventListener("click",()=>this.helpModal.show()),this.elements.languageSelect.addEventListener("change",this.handleLanguageChange),this.elements.plaintext.addEventListener("input",this.handleInputChange),this.elements.cipherInput.addEventListener("input",this.handleCipherInputChange),this.elements.toggleDemo&&this.elements.toggleDemo.addEventListener("click",()=>this.toggleDemo()),document.addEventListener("keydown",e=>this.handleKeyboardShortcuts(e)),window.addEventListener("languageChange",()=>this.onLanguageChanged())}initComponents(){return r(this,null,function*(){yield this.demoViewer.init(this.elements.demoContent),yield this.helpModal.init(),this.updateLanguageSelector()})}applyInitialState(){this.updateCharCount("plaintext"),this.updateCharCount("ciphertext"),this.updateCharCount("cipherInput"),this.updateCharCount("plaintextOutput"),this.updateButtonStates()}handleEncode(){return r(this,null,function*(){try{const e=this.elements.plaintext.value;if(!e.trim())return void this.showMessage(d.t("messages.invalidInput"),"warning");this.setButtonLoading(this.elements.encodeBtn,!0);const t=this.encoder.encode(e);this.elements.ciphertext.value=t,this.updateCharCount("ciphertext"),this.updateButtonStates(),this.showEncodingStats(e,t),this.demoViewer.showEncodingDemo(e),this.showMessage(d.t("messages.encodeSuccess"),"success")}catch(e){console.error("Encoding error:",e),this.showError(d.t("messages.encodeError"),e.message)}finally{this.setButtonLoading(this.elements.encodeBtn,!1),this.updateButtonStates()}})}handleDecode(){return r(this,null,function*(){try{const e=this.elements.cipherInput.value;if(!e.trim())return void this.showMessage(d.t("messages.invalidInput"),"warning");this.setButtonLoading(this.elements.decodeBtn,!0);const t=this.decoder.decode(e);this.elements.plaintextOutput.value=t.plaintext,this.updateCharCount("plaintextOutput"),this.updateCRCStatus(t),this.updateButtonStates(),this.demoViewer.showDecodingDemo(e),"v2"===t.formatVersion?this.showMessage(d.t("messages.decodeSuccessWithCRC"),"success"):"v1"===t.formatVersion?this.showMessage(d.t("messages.decodeSuccessLegacy"),"info"):this.showMessage(d.t("messages.decodeSuccess"),"success")}catch(e){console.error("Decoding error:",e),this.showError(d.t("messages.decodeError"),e.message)}finally{this.setButtonLoading(this.elements.decodeBtn,!1),this.updateButtonStates()}})}handleLanguageChange(){const e=this.elements.languageSelect.value;d.setLanguage(e)}handleInputChange(){this.updateCharCount("plaintext"),this.updateButtonStates(),this.elements.plaintext.value.length>0&&this.elements.plaintext.value.length<100&&this.debouncedPreview()}handleCipherInputChange(){this.updateCharCount("cipherInput"),this.validateCipherInput(),this.updateButtonStates()}validateCipherInput(){const e=this.elements.cipherInput.value;if(!e)return void this.updateValidationStatus("","none");const t=this.decoder.validateCiphertext(e);t.isValid?this.updateValidationStatus(d.t("validation.valid"),"valid"):this.updateValidationStatus(t.error,"invalid")}updateValidationStatus(e,t){this.elements.validationStatus&&(this.elements.validationStatus.textContent=e,this.elements.validationStatus.className=`validation-status ${t}`,"none"===t&&(this.elements.validationStatus.className="validation-status"))}updateCRCStatus(e){if(!this.elements.validationStatus)return;let t="",n="";"v2"===e.formatVersion&&e.crcVerified?(t=d.t("validation.crcVerified"),n="crc-verified"):"v1"===e.formatVersion?(t=d.t("validation.legacyFormat"),n="legacy-format"):(t=d.t("validation.noCrc"),n="no-crc"),this.elements.validationStatus.textContent=t,this.elements.validationStatus.className=`validation-status ${n}`}updateCharCount(e){const t=this.elements[e],n=this.elements[e+"Count"];if(t&&n){const e=t.value.length;n.textContent=e}}updateButtonStates(){const e=this.elements.plaintext.value.trim().length>0;this.elements.encodeBtn.disabled=!e;const t=this.elements.cipherInput.value.trim().length>0,n=this.decoder.validateCiphertext(this.elements.cipherInput.value).isValid;this.elements.decodeBtn.disabled=!t||!n,this.elements.copyCipherBtn.disabled=0===this.elements.ciphertext.value.length,this.elements.copyPlainBtn.disabled=0===this.elements.plaintextOutput.value.length}setButtonLoading(e,t){if(t){e.disabled=!0,e.classList.add("loading");const t=e.textContent;e.dataset.originalText=t,e.textContent="..."}else e.classList.remove("loading"),e.dataset.originalText&&(e.textContent=e.dataset.originalText,delete e.dataset.originalText)}clearInput(e){const t=this.elements[e];t&&(t.value="",this.updateCharCount(e),this.updateButtonStates(),"cipherInput"===e&&this.updateValidationStatus("","none"),this.showMessage(d.t("messages.clearSuccess"),"info"))}copyText(e){return r(this,null,function*(){const t=this.elements[e];if(t&&t.value)try{yield this.clipboard.copy(t.value),this.showMessage(d.t("messages.copySuccess"),"success");const n="ciphertext"===e?this.elements.copyCipherBtn:this.elements.copyPlainBtn;this.highlightButton(n)}catch(n){console.error("Copy failed:",n),this.showMessage(d.t("messages.copyError"),"error")}})}pasteText(e){return r(this,null,function*(){try{const t=yield this.clipboard.paste(),n=this.elements[e];n&&t&&(n.value=t,this.updateCharCount(e),this.updateButtonStates(),"cipherInput"===e&&this.validateCipherInput(),this.showMessage(d.t("messages.pasteSuccess"),"success"))}catch(t){console.error("Paste failed:",t),this.showMessage(d.t("messages.pasteError"),"error")}})}highlightButton(e){e.classList.add("highlighted"),setTimeout(()=>{e.classList.remove("highlighted")},200)}toggleDemo(){"none"!==this.elements.demoContent.style.display?(this.elements.demoContent.style.display="none",this.elements.toggleDemo.textContent=d.t("ui.expand")):(this.elements.demoContent.style.display="block",this.elements.toggleDemo.textContent=d.t("ui.collapse"))}showEncodingStats(e,t){const n=this.encoder.getEncodingStats(e,t);console.log("Encoding stats:",n)}handleKeyboardShortcuts(e){(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(document.activeElement===this.elements.plaintext?(this.handleEncode(),e.preventDefault()):document.activeElement===this.elements.cipherInput&&(this.handleDecode(),e.preventDefault())),(e.ctrlKey||e.metaKey)&&"k"===e.key&&(document.activeElement===this.elements.plaintext?this.clearInput("plaintext"):document.activeElement===this.elements.cipherInput&&this.clearInput("cipherInput"),e.preventDefault())}onLanguageChanged(){this.updateButtonStates(),this.validateCipherInput()}updateLanguageSelector(){this.elements.languageSelect.value=d.getCurrentLanguage()}debouncedPreview(){this.previewTimeout&&clearTimeout(this.previewTimeout),this.previewTimeout=setTimeout(()=>{},300)}showMessage(e,t="info",n=3e3){let i=document.getElementById("messageToast");i||(i=document.createElement("div"),i.id="messageToast",i.className="message-toast",document.body.appendChild(i)),i.textContent=e,i.className=`message-toast ${t} show`,this.messageTimeout&&clearTimeout(this.messageTimeout),this.messageTimeout=setTimeout(()=>{i.classList.remove("show")},n)}showError(e,t){const n=this.elements.errorMessage;n&&(n.innerHTML=`<strong>${e}</strong><br>${t}`,n.style.display="block",setTimeout(()=>{n.style.display="none"},5e3)),console.error(`${e}:`,t)}}).init().catch(e=>{console.error("Failed to start application:",e)});
